---
title: "Test1"
runtime: shiny
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo = F}
library(shiny)
library(ggplot2)
#User Interface
ui <- 
  fluidPage( 
    #Set up tabs
    titlePanel("Cool Application"),
    
    sidebarLayout("",
      mainPanel(width = 12,
        tabsetPanel(
          #BEGIN SCATTERPLOT TAB
          tabPanel("Scatterplot", 
                   br(),
                   fluidRow(
                     #Column for user controls (selecting which pieces of data to view and highlight)
                     column(3,
                            wellPanel(
                              #labels for data selection options
                              fluidRow(
                                column(2),
                                column(5, "x-axis"),
                                column(5, "y-axis")
                                ),
                              #row to select data types to view (such as RNAseq or DNA copy number)
                              fluidRow(
                                column(2,
                                       "Data"),
                                #input to select which data type is displayed on the x-axis
                                column(5,
                                       selectInput("datatype_x", NULL,
                                                   c("Data1" = "data1",
                                                     "Data2" = "data2",
                                                     "Data3" = "data3"))
                                       ),
                                #input to select which data type is displayed on the y-axis
                                column(5,
                                       selectInput("datatype_y", NULL,
                                                   c("Data1" = "data1",
                                                     "Data2" = "data2",
                                                     "Data3" = "data3")))
                                ),
                              #row to select which gene to view
                              fluidRow(
                                column(2,"Gene"),
                                #input to select which gene is displayed on the x-axis
                                column(5,
                                       selectInput("gene_x", NULL,
                                                   c("Gene1" = "gene1",
                                                     "Gene2" = "gene2",
                                                     "Gene3" = "gene3"))
                                       ),
                                #input to select which gene is displayed on the y-axis
                                column(5,
                                       selectInput("gene_y", NULL,
                                                   c("Gene1" = "gene1",
                                                     "Gene2" = "gene2",
                                                     "Gene3" = "gene3")))
                                )
                              ),
                            br(),
                            "Select a cancer type to highlight",
                            selectInput("variable", NULL,
                                        c("Cancer1" = "cancer1",
                                          "Cancer2" = "cancer2",
                                          "Cancer3" = "cancer3")),
                            checkboxInput("showSelected", "Show selected cancers only?", FALSE)
                            ),
                     #main column to display scatterplot and details for a selected point on the scatterplot)
                     column(9,
                            #row to display details of a user-selected point
                            fluidRow(
                              #display details from a point on the left plot ("zoomed-out" plot)
                              column(6, 
                                     fluidRow(column(1),
                                              column(10,
                                                     wellPanel("Details 1a (cell line, cancer type)"))),
                                     fluidRow(column(1),
                                              column(10,
                                                     wellPanel("Details 1b (rnaseq info, dna copy, etc)",
                                                               verbatimTextOutput("click_info")
                                                               )
                                                     )
                                              )
                              ), 
                              #display details from a point on the right plot ("zoomed-in" plot)
                              column(6,
                                     fluidRow(column(1),
                                              column(10,
                                                     wellPanel("Details 1a (cell line, cancer type)"))),
                                     fluidRow(column(1),
                                              column(10,
                                                     wellPanel("Details 1b (rnaseq info, dna copy, etc)")))
                                     )
                              ),
                            #display plots
                            fluidRow(
                              #left plot ("zoomed-out" plot)
                              column(6,
                                     wellPanel(
                                       plotOutput("plot",
                                                  click = "plot_click",
                                                  brush = brushOpts(id="plot_brush")
                                                  )
                                       ),
                                     "plot1"),
                              #right plot ("zoomed-in" plot)
                              column(6,
                                     conditionalPanel( condition = "input.showSelected==FALSE",
                                                       wellPanel(plotOutput("plot_zoom")),
                                                       "plot2")
                                     )
                              )
                            )
                     )
                   ),
          tabPanel("Heatmap", verbatimTextOutput("summary"))
        )
      )
    )
  )
server <- function(input, output) { 
  x <- rnorm(1000)
  y <- rnorm(1000)
  testdata <- data.frame(x = x, y = y)
  output$plot<- renderPlot({ 
    qplot(testdata$x,testdata$y, alpha = .50, color = "blue") 
  }) 
  output$click_info <- renderPrint({
    nearPoints(testdata, input$plot_click, addDist = TRUE)
  })
  output$plot_zoom<- renderPlot({ 
    plot(rnorm(100)) 
  }) 
}
shinyApp(ui = ui, server = server)
```
```{r, eval=F, echo = F}
source("common2.R")
stuff <- read.gct("Achilles_v3.3.8_rawreadcounts.gct")$data
stuff <- read.table("CCLE_copynumber_byGene_2013-12-03.txt",sep ="\t",header=T)
annotation <- read.table("CCLE_sample_info_file_2012-10-18.txt",sep ="\t",header=T)

list <- annotation[,c("CCLE.name","Site.Primary")]
list <- split(list[,"CCLE.name"],list[,"Site.Primary"])
stuff1 <- do.call(cbind, lapply(list, function(x){
  rowMeans(stuff[,as.character(x)])
}))


underscore <- regexpr("_",colnames(stuff))
cell_lines <- substring(colnames(stuff), 1, underscore-1)
cancer_type <- substring(colnames(stuff), underscore+1)
skin <- stuff[,grep("EGID|SYMBOL|CHR|CHRLOC|CHRLOCEND|SKIN", colnames(stuff))]

for(i in cell_lines){
  columns <- grep(i, colnames(stuff))
  
}


table(list$Site.Primary)

correlations <- cor(stuff[,6:30])
heatmap(correlations,margins=c(10,10))
```
